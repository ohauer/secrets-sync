[Unit]
Description=Docker Secrets Sync Service
Documentation=https://github.com/ohauer/secrets-sync
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
WorkingDirectory=/var/lib/secrets-sync
ExecStart=/usr/local/bin/secrets-sync --config /etc/secrets-sync/config.yaml
ExecReload=/bin/kill -HUP $MAINPID
Restart=on-failure
RestartSec=5s

# Environment file (optional)
EnvironmentFile=-/etc/default/secrets-sync

# Security hardening
User=secrets-sync
Group=secrets-sync
ConfigurationDirectory=secrets-sync
RuntimeDirectory=secrets-sync

# Filesystem protection
ProtectSystem=strict
ProtectHome=yes
# Add paths where secrets will be written (must be created manually)
# Example: ReadWritePaths=/var/secrets
# ReadWritePaths=
PrivateTmp=yes
NoNewPrivileges=yes

# Kernel protection
ProtectKernelTunables=yes
ProtectKernelModules=yes
ProtectKernelLogs=yes
ProtectControlGroups=yes

# Capabilities
CapabilityBoundingSet=
AmbientCapabilities=

# System calls
SystemCallFilter=@system-service
SystemCallFilter=~@privileged @resources
SystemCallErrorNumber=EPERM

# Network
RestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX
IPAddressDeny=any
IPAddressAllow=localhost
# Uncomment and adjust for your Vault server
#IPAddressAllow=10.0.0.0/8

# Misc
RestrictNamespaces=yes
LockPersonality=yes
RestrictRealtime=yes
RestrictSUIDSGID=yes
RemoveIPC=yes
PrivateMounts=yes
ProtectClock=yes

# Logging
StandardOutput=journal
StandardError=journal
SyslogIdentifier=secrets-sync

[Install]
WantedBy=multi-user.target
