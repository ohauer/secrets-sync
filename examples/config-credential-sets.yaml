secretStore:
  address: "http://localhost:8300"

  # Default credentials (used when secret doesn't specify credentials)
  authMethod: "token"
  token: "${VAULT_TOKEN}"

  # Named credential sets for different teams/namespaces
  credentials:
    team-a:
      authMethod: "token"
      token: "${TEAM_A_TOKEN}"

    team-b:
      authMethod: "approle"
      roleId: "${TEAM_B_ROLE_ID}"
      secretId: "${TEAM_B_SECRET_ID}"

# Credential resolution:
# - If secret specifies "credentials", use that named credential set
# - Otherwise, use default credentials from secretStore
# - Each credential set creates a separate authenticated Vault client
# - Clients are cached and reused for efficiency

secrets:
  # Uses default credentials (VAULT_TOKEN)
  - name: "default-secret"
    key: "app/config"
    mountPath: "secret"
    kvVersion: "v2"
    refreshInterval: "30m"
    template:
      data:
        api_key: '{{ .apiKey }}'
    files:
      - path: ".work/secrets/default-api-key"
        mode: "0600"

  # Uses team-a credentials (TEAM_A_TOKEN)
  - name: "team-a-secret"
    key: "app/config"
    mountPath: "secret"
    namespace: "team-a"
    credentials: "team-a"  # Reference to named credential set
    kvVersion: "v2"
    refreshInterval: "30m"
    template:
      data:
        api_key: '{{ .apiKey }}'
    files:
      - path: ".work/secrets/team-a-api-key"
        mode: "0600"

  # Uses team-b credentials (AppRole)
  - name: "team-b-secret"
    key: "app/config"
    mountPath: "secret"
    namespace: "team-b"
    credentials: "team-b"  # Reference to named credential set
    kvVersion: "v2"
    refreshInterval: "30m"
    template:
      data:
        api_key: '{{ .apiKey }}'
    files:
      - path: ".work/secrets/team-b-api-key"
        mode: "0600"
