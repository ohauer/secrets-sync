.TH SECRETS-SYNC 1 "February 2026" "secrets-sync 0.1.0" "User Commands"
.SH NAME
secrets-sync \- sync secrets from HashiCorp Vault to filesystem
.SH SYNOPSIS
.B secrets-sync
[\fB\-c\fR|\fB\-\-config\fR \fIFILE\fR]
.br
.B secrets-sync
\fBhelp\fR|\fB\-h\fR|\fB\-\-help\fR
.br
.B secrets-sync
\fBversion\fR|\fB\-v\fR|\fB\-\-version\fR
.br
.B secrets-sync
\fBinit\fR
.br
.B secrets-sync
\fBvalidate\fR
.br
.B secrets-sync
\fBisready\fR
.br
.B secrets-sync
\fBconvert\fR \fIFILE\fR [\fB\-\-query\-vault\fR] [\fB\-\-mount\-path\fR \fIPATH\fR]
.SH DESCRIPTION
.B secrets-sync
is a lightweight sidecar container for managing secrets from HashiCorp Vault or OpenBao in Docker/Podman environments. It continuously syncs secrets to the filesystem with configurable refresh intervals.
.PP
The tool supports multiple authentication methods (Token, AppRole), TLS with custom CA certificates, template-based secret mapping, and includes circuit breaker protection for resilience.
.SH OPTIONS
.TP
.BR \-c ", " \-\-config " " \fIFILE\fR
Path to configuration file. Overrides CONFIG_FILE environment variable.
.TP
.BR \-h ", " \-\-help
Display help information and exit.
.TP
.BR \-v ", " \-\-version
Display version information and exit.
.SH COMMANDS
.TP
.B help
Display usage information.
.TP
.B version
Display version, git commit, and build date.
.TP
.B init
Generate a sample configuration file with all available options.
.TP
.B validate
Validate configuration file without running the service.
.TP
.B isready
Check if service is ready (for health checks).
.TP
.B convert \fIFILE\fR
Convert external-secrets-operator ExternalSecret to secrets-sync format.
.RS
.TP
.B \-\-query\-vault
Query Vault for actual field names (recommended).
.TP
.B \-\-mount\-path \fIPATH\fR
Specify Vault mount path manually.
.RE
.SH CONFIGURATION
Configuration can be provided via YAML file or environment variables. Environment variables override config file values.
.SS Config File Locations
Configuration files are searched in the following order:
.RS
.IP 1. 3
Path specified by \fB\-\-config\fR flag
.IP 2.
Path specified by \fBCONFIG_FILE\fR environment variable
.IP 3.
\fB./config.yaml\fR (current directory)
.IP 4.
\fB/etc/secrets-sync/config.yaml\fR (system-wide)
.RE
.SS Example Configuration
.nf
secretStore:
  address: "https://vault.example.com:8200"
  authMethod: "token"
  token: "${VAULT_TOKEN}"
  tlsCACert: "/etc/ssl/certs/ca-bundle.pem"

secrets:
  - name: "database-credentials"
    key: "secret/data/db/prod"
    mountPath: "secret"
    kvVersion: "v2"
    refreshInterval: "5m"
    template:
      data:
        username: '{{ .username }}'
        password: '{{ .password }}'
    files:
      - path: "/secrets/db-user"
        mode: "0600"
      - path: "/secrets/db-pass"
        mode: "0600"
.fi
.SH ENVIRONMENT VARIABLES
.TP
.B CONFIG_FILE
Path to configuration file.
.TP
.B VAULT_ADDR
Vault server address (e.g., https://vault.example.com:8200).
.TP
.B VAULT_TOKEN
Vault authentication token.
.TP
.B VAULT_ROLE_ID
Vault AppRole role ID.
.TP
.B VAULT_SECRET_ID
Vault AppRole secret ID.
.TP
.B VAULT_CACERT
Path to CA certificate file for TLS verification.
.TP
.B VAULT_CAPATH
Path to directory containing CA certificates.
.TP
.B VAULT_SKIP_VERIFY
Skip TLS certificate verification (insecure, not recommended).
.TP
.B VAULT_CLIENT_CERT
Path to client certificate for mTLS.
.TP
.B VAULT_CLIENT_KEY
Path to client key for mTLS.
.TP
.B LOG_LEVEL
Logging level: debug, info, warn, error (default: info).
.TP
.B WATCH_CONFIG
Enable configuration file watching for hot reload (default: false).
.TP
.B ENABLE_METRICS
Enable Prometheus metrics endpoint (default: true).
.TP
.B METRICS_ADDR
Metrics server bind address (default: 127.0.0.1).
.TP
.B METRICS_PORT
Metrics server port, range 1025-65535 (default: 8080).
.TP
.B STATUS_FILE
Path to readiness status file (default: /tmp/secrets-sync-ready).
.TP
.B ENABLE_TRACING
Enable OpenTelemetry tracing (default: false).
.TP
.B OTEL_EXPORTER_ENDPOINT
OpenTelemetry collector endpoint.
.SH SIGNALS
.TP
.B SIGTERM, SIGINT
Graceful shutdown. Stops syncing and exits cleanly.
.TP
.B SIGHUP
Reload configuration without restarting. Validates new config before applying.
.SH FILES
.TP
.I /etc/secrets-sync/config.yaml
System-wide configuration file.
.TP
.I /etc/default/secrets-sync
Environment variables for systemd service.
.TP
.I /var/lib/secrets-sync/
Default state directory for systemd service.
.TP
.I /tmp/secrets-sync-ready
Default readiness status file.
.SH SYSTEMD INTEGRATION
.SS Installation
.nf
sudo make install-systemd
.fi
.SS Service Management
.nf
# Start service
sudo systemctl start secrets-sync

# Stop service
sudo systemctl stop secrets-sync

# Reload configuration (SIGHUP)
sudo systemctl reload secrets-sync

# Check status
sudo systemctl status secrets-sync

# View logs
sudo journalctl -u secrets-sync -f
.fi
.SS Security Hardening
The systemd service includes extensive security hardening:
.RS
.IP \(bu 2
DynamicUser (runs as ephemeral user)
.IP \(bu
ProtectSystem=strict (read-only filesystem)
.IP \(bu
PrivateTmp (isolated /tmp)
.IP \(bu
NoNewPrivileges (cannot gain privileges)
.IP \(bu
ProtectKernelTunables (kernel protection)
.IP \(bu
RestrictAddressFamilies (network restrictions)
.IP \(bu
SystemCallFilter (syscall restrictions)
.RE
.SH METRICS
Prometheus metrics are exposed on http://127.0.0.1:8080/metrics by default.
.SS Available Metrics
.TP
.B secret_fetch_total
Total number of secret fetch attempts.
.TP
.B secret_fetch_errors_total
Total number of secret fetch errors.
.TP
.B secret_sync_duration_seconds
Histogram of secret sync durations.
.TP
.B circuit_breaker_state
Current circuit breaker state (0=closed, 1=half-open, 2=open).
.TP
.B secrets_configured
Number of configured secrets.
.TP
.B secrets_synced
Number of successfully synced secrets.
.SH SECURITY
.SS File Operations
.IP \(bu 2
Atomic writes using random temporary files
.IP \(bu
Symlink rejection
.IP \(bu
Device file rejection
.IP \(bu
Path traversal prevention
.IP \(bu
Configurable file permissions (default: 0600)
.SS Resource Limits
.IP \(bu 2
Maximum secret size: 1MB
.IP \(bu
Maximum Vault response size: 10MB
.IP \(bu
Maximum secret count: 100
.IP \(bu
Minimum refresh interval: 30 seconds
.SS Path Validation
.IP \(bu 2
Relative paths resolved to absolute paths
.IP \(bu
Path length limits (4096 on Unix, 260 on Windows)
.IP \(bu
Windows extended paths rejected (\\\\?\\)
.IP \(bu
UNC paths rejected (\\\\server\\share)
.SH EXAMPLES
.SS Basic Usage
.nf
# Generate sample config
secrets-sync init > config.yaml

# Validate configuration
secrets-sync validate

# Run with config file
secrets-sync --config config.yaml
.fi
.SS Token Authentication
.nf
export VAULT_ADDR=https://vault.example.com:8200
export VAULT_TOKEN=hvs.CAESIJ...
secrets-sync --config config.yaml
.fi
.SS AppRole Authentication
.nf
export VAULT_ADDR=https://vault.example.com:8200
export VAULT_ROLE_ID=role-id-here
export VAULT_SECRET_ID=secret-id-here
secrets-sync --config config.yaml
.fi
.SS Custom CA Certificate
.nf
export VAULT_ADDR=https://vault.example.com:8200
export VAULT_TOKEN=hvs.CAESIJ...
export VAULT_CACERT=/etc/ssl/certs/ca-bundle.pem
secrets-sync --config config.yaml
.fi
.SS Convert from external-secrets-operator
.nf
# Basic conversion
secrets-sync convert external-secret.yaml > config.yaml

# Query Vault for field names
export VAULT_ADDR=https://vault.example.com:8200
export VAULT_TOKEN=hvs.CAESIJ...
secrets-sync convert external-secret.yaml --query-vault > config.yaml

# From kubectl
kubectl get externalsecret my-secret -o json | \\
  secrets-sync convert - --query-vault > config.yaml
.fi
.SS Systemd Service
.nf
# Install service
sudo make install-systemd

# Configure
sudo vim /etc/secrets-sync/config.yaml
sudo vim /etc/default/secrets-sync

# Start and enable
sudo systemctl enable --now secrets-sync

# Reload configuration
sudo systemctl reload secrets-sync

# Check status
sudo systemctl status secrets-sync
sudo journalctl -u secrets-sync -f
.fi
.SH EXIT STATUS
.TP
.B 0
Success
.TP
.B 1
General error (configuration, Vault connection, etc.)
.TP
.B 2
Invalid command line arguments
.SH BUGS
Report bugs at: https://github.com/ohauer/docker-secrets/issues
.SH AUTHOR
Written by Oliver Hauer.
.SH COPYRIGHT
Copyright \(co 2026 Oliver Hauer.
.br
License: MIT License
.SH SEE ALSO
.BR systemctl (1),
.BR journalctl (1),
.BR vault (1)
.PP
Full documentation: https://github.com/ohauer/docker-secrets
.PP
Systemd deployment guide: /usr/share/doc/secrets-sync/systemd-deployment.md
